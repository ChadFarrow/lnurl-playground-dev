import{a as v,t as f,c as ve}from"../chunks/disclose-version.D2fD36qC.js";import"../chunks/legacy.DDnI4mLS.js";import{_ as pe,g as e,a1 as he,a7 as m,a2 as o,a4 as n,$ as R,a3 as i,a8 as ue,a0 as w,ae as V,s,Y as me}from"../chunks/runtime.BAIukHDA.js";import{e as q,s as S}from"../chunks/render.B39leecd.js";import{i as P}from"../chunks/if.B3BZkMBm.js";import{e as fe,i as ge}from"../chunks/each.CWQedB2T.js";import{a as x,u as W,r as ye}from"../chunks/state.svelte.Dm3V9rYH.js";import{b as _e}from"../chunks/input.BH0JO5kO.js";import{i as be}from"../chunks/lifecycle.D45BoICY.js";const we={podcast:"CurioCaster",episode:"Alt Enclosure Test",guid:"58183156-a6ae-5e36-8875-a1be2ab691bd",episode_guid:"CC00e",ts:10,speed:"1",action:"boost",app_name:"CurioCaster",value_msat_total:1e4,url:"https://curiocaster.com/rss/feed.xml",sender_name:"Steven B",sender_id:"steven@getalby.com",reply_address:"035ad2c954e264004986da2d9499e1732e5175e1dcef2453c921c6cdcc3536e9d8",message:"This is a test of The Split Box"};var Se=f('<p class="svelte-i0th4g"> </p>'),xe=f('<p class="svelte-i0th4g"> </p>'),$e=f('<pre class="svelte-i0th4g"> </pre>'),ke=f("<div><button>Fetch Metaboost Data</button></div> <div><!></div>",1),Te=f(`<a href="/">Back</a> <h1>Split Box Autopay Demo</h1> <h2 class="svelte-i0th4g"> </h2> <div class="autopay svelte-i0th4g"><div class="recipient"><label for="boost-amount" class="svelte-i0th4g">Amount (sats):</label> <input id="boost-amount" type="number" placeholder="Enter Amount in sats" required></div> <button type="button" class="svelte-i0th4g">Autopay</button></div> <!> <!> <h2 class="svelte-i0th4g">This is what you'll see in a feed.</h2> <pre class="svelte-i0th4g">
        <code class="svelte-i0th4g"></code>
</pre> <h3 class="svelte-i0th4g">When the user sends a boost, the <code class="svelte-i0th4g">invoice</code> is fetched from the
      url, <br>your app pays the <code class="svelte-i0th4g">invoice</code> for the user, <br>then forwards the payment details to the <code class="svelte-i0th4g">webhook</code> url. <br>The webhook url will send back a lookup GUID to fetch payment status
      asynchronously, <br>or the payment status synchronously.</h3> <h2 class="svelte-i0th4g">Simulated Payload to The Split Box</h2> <p class="svelte-i0th4g"> </p>`,1),Ce=f("<main><!></main>");function Fe(Y,z){pe(z,!1);let g=m({lnaddress:"thesplitbox@getalby.com",amount:100}),j=`${x}/invoice?address=${e(g).lnaddress}`,O=`${x}/webhook-sync`,p=m({type:"bitcoin-lightning",metadata:we}),t=m([]),y=m(""),$=m(null),k=m(null);async function H(a){s(y,""),s(t,["Press F12 to view updates in console"]),s(t,e(t));try{a.metadata.value_msat_total=e(g).amount*1e3,a=a,e(t).push(`Fetching invoice from ${j}`),s(t,e(t));const r=await(await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();console.log(r),e(t).push("Paying Invoice"),s(t,e(t));let T=await K(r);console.log(T),e(t).push("Invoice paid."),s(t,e(t)),L(T.info)}catch(l){console.log(l)}}async function K(a){try{return await(await fetch(`${x}/alby/pay-invoice`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json()}catch(l){console.error(l)}}async function L(a){console.log(a),e(t).push(`Sending payment info to ${O} and sending out splits`),s(t,e(t));let r=await(await fetch(O,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();console.log(r),s(y,r.id),e(t).push("Splits sent. View split status in console"),e(t).push(`Click this to see the stored metadata at ${x}/metadata/${e(y)}`),s(t,e(t))}function Q(a){V(p,e(p).metadata.value_msat_total=a.target.value*1e3),s(p,e(p))}const X=async()=>{s(k,null),s($,null);try{const a=await fetch(`${x}/metadata/${e(y)}`);if(!a.ok)throw new Error("Failed to fetch data");s($,await a.json())}catch(a){s(k,a.message)}};be();var A=Ce(),Z=o(A);{var ee=a=>{var l=Te(),r=n(R(l),4),T=o(r);i(r);var B=n(r,2),D=o(B),J=n(o(D),2);ye(J),i(D);var te=n(D,2),ae=me(()=>H.bind(this,e(p)));i(B);var G=n(B,2);fe(G,1,()=>e(t),ge,(c,d,_)=>{var b=Se(),C=o(b);i(b),w(()=>S(C,`Step ${_+1}. ${e(d)??""}`)),v(c,b)});var M=n(G,2);{var se=c=>{var d=ke(),_=R(d),b=o(_);i(_);var C=n(_,2),re=o(C);{var ne=h=>{var u=xe(),E=o(u);i(u),w(()=>S(E,`Error: ${e(k)??""}`)),v(h,u)},le=h=>{var u=ve(),E=R(u);{var ce=F=>{var I=$e(),de=o(I,!0);w(()=>S(de,JSON.stringify(e($),null,2))),i(I),v(F,I)};P(E,F=>{e($)&&F(ce)},!0)}v(h,u)};P(re,h=>{e(k)?h(ne):h(le,!1)})}i(C),q("click",b,X),v(c,d)};P(M,c=>{e(y)&&c(se)})}var N=n(M,4),oe=n(o(N));oe.textContent=`
          ${`
<podcast:splitbox
  invoice="${j}" 
  webhook="${O}" 
/>
`??""}
`,ue(),i(N);var U=n(N,6),ie=o(U,!0);w(()=>S(ie,JSON.stringify(e(p),null,2))),i(U),w(()=>S(T,`Paying from ${W.address??""}`)),_e(J,()=>e(g).amount,c=>V(g,e(g).amount=c)),q("input",J,Q),q("click",te,function(...c){var d;(d=e(ae))==null||d.apply(this,c)}),v(a,l)};P(Z,a=>{W.address&&a(ee)})}i(A),v(Y,A),he()}export{Fe as component};
