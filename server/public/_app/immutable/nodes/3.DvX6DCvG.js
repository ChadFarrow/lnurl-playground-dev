import{a as m,t as f}from"../chunks/disclose-version.CLSgSQsP.js";import"../chunks/legacy.BmB4yKmK.js";import{p as M,t as v,a as V,b as n,g as t,a7 as w,m as u,s as r,c as d,r as p,a2 as z}from"../chunks/runtime.DGcIvRwn.js";import{e as j,s as S}from"../chunks/render.CuAIxSMc.js";import{o as H,i as K}from"../chunks/index-client.BHtjslJN.js";import{e as Q,i as W}from"../chunks/each.BvY3kG6l.js";import{b as O,a as h,r as I,d as X,c as Y,s as Z}from"../chunks/state.svelte.DZe6J9bz.js";import{i as ee}from"../chunks/lifecycle.DU200Xqh.js";const te={podcast:"CurioCaster",episode:"Alt Enclosure Test",guid:"58183156-a6ae-5e36-8875-a1be2ab691bd",episode_guid:"CC00e",feedID:4935828,itemID:7133051987,ts:10,speed:"1",action:"boost",app_name:"CurioCaster",value_msat_total:1e4,url:"https://curiocaster.com/rss/feed.xml",sender_name:"Steven B",sender_id:"steven@getalby.com",reply_address:"035ad2c954e264004986da2d9499e1732e5175e1dcef2453c921c6cdcc3536e9d8",message:"This is a test of The Split Box"};var ae=f("<h2> </h2>"),se=f('<h2>Log in with <a id="alby-login">Alby</a></h2>'),oe=f('<p class="svelte-12opxfk"> </p>'),ne=f('<main><h1>Split Box Autopay Demo</h1> <!> <div class="recipient svelte-12opxfk"><label for="control-lnaddress" class="svelte-12opxfk">Lightning Address:</label> <input id="control-lnaddress" type="text" placeholder="Enter Lightning Address" required class="svelte-12opxfk"> <label for="boost-amount" class="svelte-12opxfk">Amount (sats):</label> <input id="boost-amount" type="number" placeholder="Enter Amount in sats" required class="svelte-12opxfk"></div> <button type="button" class="svelte-12opxfk">Get Invoice</button> <!> <h2>Simulated Payload to The Split Box</h2> <p class="svelte-12opxfk"> </p></main>');function ve(B,J){M(J,!1);let b=u(),i=u({lnaddress:"thesplitbox@getalby.com",amount:100}),k=u(""),l=u({type:"bitcoin-lightning",metadata:te}),s=u([]);H(()=>{n(k,`https://getalby.com/oauth?client_id=${X}&response_type=code&redirect_uri=${Y}&scope=account:read%20balance:read%20payments:send%20invoices:read`),E()});async function L(e){n(s,["Press F12 to view uupdates in console."]),n(s,t(s));try{e.metadata.value_msat_total=t(i).amount*1e3,e=e;let a=`${h}/invoice?address=${t(i).lnaddress}`;t(s).push(`fetching invoice from ${a}`),n(s,t(s));const c=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(c),t(s).push("paying Invoice"),n(s,t(s));let $=await N(c);console.log($),t(s).push("invoice paid."),n(s,t(s)),D($.info)}catch(a){console.log(a)}}async function N(e){try{return await(await fetch(`${h}/alby/invoice`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(a){console.error(a)}}async function D(e){console.log(e);let a=`${h}/webhook-sync`;t(s).push(`sending payment info to ${a} and sending out splits`),n(s,t(s));let c=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(c),t(s).push("splits sent. View split status in console."),n(s,t(s))}async function E(){try{const a=await(await fetch(`${h}/alby/refresh`,{credentials:"include"})).json();console.log(a),n(b,a.lightning_address)}catch{}}function R(e){w(l,t(l).metadata.value_msat_total=e.target.value*1e3),n(l,t(l))}ee();var y=ne(),C=r(d(y),2);{var q=e=>{var a=ae(),o=d(a);p(a),v(()=>S(o,`Paying from ${t(b)??""}`)),m(e,a)},U=e=>{var a=se(),o=r(d(a));p(a),v(()=>Z(o,"href",t(k))),m(e,a)};K(C,e=>{t(b)?e(q):e(U,!1)})}var g=r(C,2),_=r(d(g),2);I(_);var x=r(_,4);I(x),p(g);var T=r(g,2),F=z(()=>L.bind(this,t(l))),A=r(T,2);Q(A,1,()=>t(s),W,(e,a)=>{var o=oe(),c=d(o,!0);p(o),v(()=>S(c,t(a))),m(e,o)});var P=r(A,4),G=d(P,!0);v(()=>S(G,JSON.stringify(t(l),null,2))),p(P),p(y),O(_,()=>t(i).lnaddress,e=>w(i,t(i).lnaddress=e)),O(x,()=>t(i).amount,e=>w(i,t(i).amount=e)),j("input",x,R),j("click",T,function(...e){var a;(a=t(F))==null||a.apply(this,e)}),m(B,y),V()}export{ve as component};
