import{a as m,t as h}from"../chunks/disclose-version.7j4NRPBk.js";import"../chunks/legacy.gulogbkn.js";import{p as M,t as v,a as V,b as n,g as t,ab as x,m as u,s as r,c as d,r as p,a2 as z}from"../chunks/runtime.ZI_R2Xfb.js";import{e as O,s as w}from"../chunks/render.yomwAJcy.js";import{o as H,i as K}from"../chunks/index-client.Dt-sng6h.js";import{e as Q,i as W}from"../chunks/each.CPujStf3.js";import{b as $,r as I,s as X}from"../chunks/input.BcYwlR1Q.js";import{i as Y}from"../chunks/lifecycle.D8EBLbuJ.js";import{r as S,b as Z,a as ee}from"../chunks/state.svelte.DzVwBfPL.js";const te={podcast:"CurioCaster",episode:"Alt Enclosure Test",guid:"58183156-a6ae-5e36-8875-a1be2ab691bd",episode_guid:"CC00e",feedID:4935828,itemID:7133051987,ts:10,speed:"1",action:"boost",app_name:"CurioCaster",value_msat_total:1e4,url:"https://curiocaster.com/rss/feed.xml",sender_name:"Steven B",sender_id:"steven@getalby.com",reply_address:"035ad2c954e264004986da2d9499e1732e5175e1dcef2453c921c6cdcc3536e9d8",message:"This is a test of The Split Box"};var ae=h("<h2> </h2>"),se=h('<h2>Log in with <a id="alby-login">Alby</a></h2>'),oe=h('<p class="svelte-12opxfk"> </p>'),ne=h('<main><h1>Split Box Autopay Demo</h1> <!> <div class="recipient svelte-12opxfk"><label for="control-lnaddress" class="svelte-12opxfk">Lightning Address:</label> <input id="control-lnaddress" type="text" placeholder="Enter Lightning Address" required class="svelte-12opxfk"> <label for="boost-amount" class="svelte-12opxfk">Amount (sats):</label> <input id="boost-amount" type="number" placeholder="Enter Amount in sats" required class="svelte-12opxfk"></div> <button type="button" class="svelte-12opxfk">Get Invoice</button> <!> <h2>Simulated Payload to The Split Box</h2> <p class="svelte-12opxfk"> </p></main>');function he(B,J){M(J,!1);let f=u(),i=u({lnaddress:"thesplitbox@getalby.com",amount:100}),k=u(""),l=u({type:"bitcoin-lightning",metadata:te}),s=u([]);H(()=>{n(k,`https://getalby.com/oauth?client_id=${Z}&response_type=code&redirect_uri=${ee}&scope=account:read%20balance:read%20payments:send%20invoices:read`),E()});async function L(e){n(s,["Press F12 to view uupdates in console."]),n(s,t(s));try{e.metadata.value_msat_total=t(i).amount*1e3,e=e;let a=`${S}/invoice?address=${t(i).lnaddress}`;t(s).push(`fetching invoice from ${a}`),n(s,t(s));const c=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(c),t(s).push("paying Invoice"),n(s,t(s));let j=await N(c);console.log(j),t(s).push("invoice paid."),n(s,t(s)),D(j.info)}catch(a){console.log(a)}}async function N(e){try{return await(await fetch("http://localhost:3000/alby/invoice",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(a){console.error(a)}}async function D(e){console.log(e);let a=`${S}/webhook-sync`;t(s).push(`sending payment info to ${a} and sending out splits`),n(s,t(s));let c=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(c),t(s).push("splits sent. View split status in console."),n(s,t(s))}async function E(){try{const a=await(await fetch(`${S}/alby/refresh`,{credentials:"include"})).json();console.log(a),n(f,a.lightning_address)}catch{}}function R(e){x(l,t(l).metadata.value_msat_total=e.target.value*1e3),n(l,t(l))}Y();var b=ne(),C=r(d(b),2);{var q=e=>{var a=ae(),o=d(a);p(a),v(()=>w(o,`Paying from ${t(f)??""}`)),m(e,a)},U=e=>{var a=se(),o=r(d(a));p(a),v(()=>X(o,"href",t(k))),m(e,a)};K(C,e=>{t(f)?e(q):e(U,!1)})}var y=r(C,2),g=r(d(y),2);I(g);var _=r(g,4);I(_),p(y);var T=r(y,2),F=z(()=>L.bind(this,t(l))),A=r(T,2);Q(A,1,()=>t(s),W,(e,a)=>{var o=oe(),c=d(o,!0);p(o),v(()=>w(c,t(a))),m(e,o)});var P=r(A,4),G=d(P,!0);v(()=>w(G,JSON.stringify(t(l),null,2))),p(P),p(b),$(g,()=>t(i).lnaddress,e=>x(i,t(i).lnaddress=e)),$(_,()=>t(i).amount,e=>x(i,t(i).amount=e)),O("input",_,R),O("click",T,function(...e){var a;(a=t(F))==null||a.apply(this,e)}),m(B,b),V()}export{he as component};
