import{c as C,a as v,t as _}from"../chunks/disclose-version.CLSgSQsP.js";import"../chunks/legacy.BmB4yKmK.js";import{p as ra,f as j,a as oa,b as s,g as a,m as u,c as n,r as l,s as o,a6 as ia,t as M}from"../chunks/runtime.DGcIvRwn.js";import{s as J,e as N}from"../chunks/render.CuAIxSMc.js";import{o as na,i as q}from"../chunks/index-client.BHtjslJN.js";import{e as la,i as ca}from"../chunks/each.BvY3kG6l.js";import{u as da,a as m,c as z,d as pa,r as B,s as L,b as E}from"../chunks/state.svelte.DZe6J9bz.js";import{i as va}from"../chunks/lifecycle.DU200Xqh.js";import{g as ua}from"../chunks/entry.Clzcpsgv.js";var fa=_('<h1 class="svelte-15i8pkp">Loading...</h1>'),ha=_('<div class="input-group"><label>Podcast GUID</label> <input type="text"></div>'),ga=_('<h1 class="svelte-15i8pkp"> </h1> <div><button class="svelte-15i8pkp">Save Settings</button></div> <div class="input-group"><label for="alby-access-token">Alby Access Token</label> <input type="password" id="alby-access-token"> <span class="svelte-15i8pkp"> </span></div> <h3 class="svelte-15i8pkp">Approved Podcast GUIDs</h3> <div><button class="svelte-15i8pkp">Add GUID</button></div> <!>',1),ma=_('<h2>Log in with <a id="alby-login">Alby</a></h2>');function Ta(F,H){ra(H,!1),da.name;let P=u(""),$=u(!0),c=u(),y=u(""),w=u(!1),r=u([""]);na(async()=>{s(P,`https://getalby.com/oauth?client_id=${pa}&response_type=code&redirect_uri=${z}&scope=account:read%20balance:read%20payments:send%20invoices:read`),await K(),s($,!1),console.log("DOM is fully loaded")});async function K(){console.log(m),s(c,null);const e=new URL(window.location.href).searchParams.get("code");if(e)try{const f=await(await fetch(`${m}/alby/auth?code=${e}&redirect_uri=${z}`,{credentials:"include"})).json();s(c,f.lightning_address);const h=new URL(window.location);h.searchParams.delete("code"),ua(h.pathname+h.search,{replaceState:!0}),await D()}catch(i){console.error(i)}else try{const f=await(await fetch(`${m}/alby/refresh`,{credentials:"include"})).json();s(c,f.lightning_address),await D()}catch{}}async function D(){try{const e=await(await fetch(`${m}/fetch-settings`,{credentials:"include"})).json();console.log(e),s(w,e.albyAccessToken),s(r,e.approvedGuids)}catch{}}async function Q(){console.log("Reset password for:",a(c));const t={albyAccessToken:a(y),approvedGuids:a(r)};(await(await fetch(m+"/save-settings",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()).status==="saved"&&(s(w,!0),alert("Setting Saved"))}va();var I=C(),V=j(I);{var W=t=>{var e=fa();v(t,e)},X=t=>{var e=C(),i=j(e);{var f=d=>{var p=ga(),g=j(p),Y=n(g,!0);l(g);var k=o(g,2),Z=n(k);l(k);var S=o(k,2),A=o(n(S),2);B(A);var R=o(A,2),aa=n(R,!0);l(R),l(S);var U=o(S,4),ea=n(U);l(U);var ta=o(U,2);la(ta,1,()=>a(r),ca,(x,ba,b)=>{var G=ha(),O=n(G);L(O,"for",`guid=${b}`);var T=o(O,2);B(T),L(T,"id",`guid=${b}`),l(G),E(T,()=>a(r)[b],sa=>(a(r)[b]=sa,ia(()=>a(r)))),v(x,G)}),M(()=>{J(Y,a(c)),J(aa,a(w)?"saved":"")}),N("click",Z,Q),E(A,()=>a(y),x=>s(y,x)),N("click",ea,()=>{a(r).unshift(""),s(r,a(r))}),v(d,p)},h=d=>{var p=ma(),g=o(n(p));l(p),M(()=>L(g,"href",a(P))),v(d,p)};q(i,d=>{a(c)?d(f):d(h,!1)},!0)}v(t,e)};q(V,t=>{a($)?t(W):t(X,!1)})}v(F,I),oa()}export{Ta as component};
